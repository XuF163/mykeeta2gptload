services:
  mykeeta:
    build: .
    container_name: mykeeta
    working_dir: /app
    init: true
    shm_size: "1gb"
    environment:
      PYTHONUNBUFFERED: "1"
      # Persist venv outside /app so bind-mounting the repo doesn't hide it.
      UV_PROJECT_ENVIRONMENT: /opt/uv-venv
      # Secrets/endpoints (recommended to set in your server env or an .env file)
      GPTMAIL_API_KEY: "${GPTMAIL_API_KEY:-}"
      GPT_LOAD_BASE_URL: "${GPT_LOAD_BASE_URL:-}"
      GPT_LOAD_GROUP_NAME: "${GPT_LOAD_GROUP_NAME:-}"
      GPT_LOAD_AUTH_KEY: "${GPT_LOAD_AUTH_KEY:-}"
    volumes:
      # Use your existing config.toml and keep outputs on the host.
      - ./:/app
      - uv_venv:/opt/uv-venv
      - uv_cache:/root/.cache/uv
    command: >
      sh -lc "uv sync --frozen && xvfb-run -a uv run python run.py"

volumes:
  uv_venv:
  uv_cache:
